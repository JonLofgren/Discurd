<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Discurd</title>
    <link rel="stylesheet" href="css/bootstrap.css"/>
    <link rel="icon" type="image/x-icon" href="/images/logo.png">
    <link rel="stylesheet" href="css/messaging.css"/>
    <script src="js/jquery-3.6.0.js"></script>
    <script src="js/bootstrap.js"></script>
</head>

<body>

<div>
    <nav id="sidebar" class="secondary_c">
        <div class="position-sticky">
            <div class="list-group list-group-flush mx-3 mt-4">
                <h3><span class="text-white mx-3">Conversations</span></h3>
                <ul id="conversations"></ul>
            </div>
            <ul class="list-unstyled CTAs">
                <li>
                    <a class="btn text-white m-3" data-toggle="modal" data-target="#searchModal"
                       style="background: #3fb67f">Add Conversation
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="modal fade rounded" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content bg-dark">
                <div class="modal-header" style="border-bottom: 1px solid #303136">
                    <h5 class="modal-title text-white" id="searchModalLabel">Find a Friend</h5>
                    <button onclick="closeModal()" type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true" class="text-white">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form class="input-group w-auto my-auto">
                        <input
                                autocomplete="off"
                                id="addField"
                                type="search"
                                maxlength="20"
                                class="form-control rounded text-white"
                                placeholder='Enter a Username'
                                style="min-width: 225px;background-color: #444"
                        />
                    </form>
                </div>
                <div class="modal-footer" style="border-top: 1px solid #303136">
                    <h4 class="text-danger ml-auto" id="alert"></h4>
                    <button type="button" id="group" class="btn btn-secondary" onclick="addConversation()">Create Group</button>
                    <button type="button" id="add" class="btn btn-secondary" onclick="addConversation()">Add</button>
                </div>
            </div>
        </div>
    </div>

    <div id="content">
        <nav id="main-navbar" class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
            <div class="container-fluid">
                <a class="navbar-brand btn text-white" type="button" id="sidebarCollapse">
                    <img
                            src="images/logo.png"
                            height="25"
                            alt=""
                            loading="lazy"
                    /> Discurd
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                         class="bi bi-list" viewBox="0 0 16 16">
                        <path fill-rule="evenodd"
                              d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
                    </svg>
                </a>

                <div>
                    <span class="text-white w-auto my-auto" id="user"></span>
                    <a href="login.html">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="indianRed"
                         class="bi bi-box-arrow-right" viewBox="0 0 16 16" style="cursor: pointer;" onclick='document.cookie.split(";").forEach(function(c) { document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); });'>
                        <path fill-rule="evenodd"
                              d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z"/>
                        <path fill-rule="evenodd"
                              d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"/>
                    </svg>
                    </a>
                </div>
                <!--
                                <form class="input-group w-auto my-auto">
                                    <input
                                            autocomplete="off"
                                            type="search"
                                            class="form-control rounded text-white border-dark"
                                            placeholder='Search'
                                            style="min-width: 225px;background-color: #444"
                                    />
                                </form>
                                -->
            </div>
        </nav>
        <div id="messages">
            <br><br>
            <h5 class="text-white font-weight-bold">Billy 05/03/22</h5>
            <p class="text-white">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Blanditiis eum excepturi
                illo ipsam itaque neque odio soluta. Architecto atque, consectetur dolor doloremque ea ex laudantium
                nemo neque nesciunt nulla odio provident quo similique, sint sunt ullam vero voluptatibus. Odio,
                praesentium!</p>

            <h5 class="text-white font-weight-bold">Joe 05/03/22</h5>
            <p class="text-white">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Blanditiis eum excepturi
                illo ipsam itaque neque<br> ipsum dolor sit amet, consectetur adipisicing elit. Molestiae, sint!<br>
                Lorem ipsum dolor sit amet, consectetur adipisicing elit. Expedita illo libero placeat quas recusandae
                sequi. Accusantium dolore doloremque expedita explicabo inventore labore numquam rem repellat velit,
                voluptates! Ad, consectetur culpa cum ipsum iure molestiae molestias officia omnis pariatur quas
                voluptate.
            </p>

            <h5 class="text-white font-weight-bold">Billy 05/03/22</h5>
            <p class="text-white">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Blanditiis eum excepturi
                illo ipsam itaque neque odio soluta. Architecto atque, consectetur dolor doloremque ea ex laudantium
                nemo neque nesciunt nulla odio provident quo similique, sint sunt ullam vero voluptatibus. Odio,
                praesentium!</p>

            <h5 class="text-white font-weight-bold">Joe 05/03/22</h5>
            <p class="text-white">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Blanditiis eum excepturi
                illo ipsam itaque neque<br> ipsum dolor sit amet, consectetur adipisicing elit. Molestiae, sint!<br>
                Lorem ipsum dolor sit amet, consectetur adipisicing elit. Expedita illo libero placeat quas recusandae
                sequi. Accusantium dolore doloremque expedita explicabo inventore labore numquam rem repellat velit,
                voluptates! Ad, consectetur culpa cum ipsum iure molestiae molestias officia omnis pariatur quas
                voluptate.
            </p>

            <h5 class="text-white font-weight-bold">Billy 05/03/22</h5>
            <p class="text-white">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Blanditiis eum excepturi
                illo ipsam itaque neque odio soluta. Architecto atque, consectetur dolor doloremque ea ex laudantium
                nemo neque nesciunt nulla odio provident quo similique, sint sunt ullam vero voluptatibus. Odio,
                praesentium!</p>

            <h5 class="text-white font-weight-bold">Joe 05/03/22</h5>
            <p class="text-white">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Blanditiis eum excepturi
                illo ipsam itaque neque<br> ipsum dolor sit amet, consectetur adipisicing elit. Molestiae, sint!<br>
                Lorem ipsum dolor sit amet, consectetur adipisicing elit. Expedita illo libero placeat quas recusandae
                sequi. Accusantium dolore doloremque expedita explicabo inventore labore numquam rem repellat velit,
                voluptates! Ad, consectetur culpa cum ipsum iure molestiae molestias officia omnis pariatur quas
                voluptate.
            </p>

            <h5 class="text-white font-weight-bold">Billy 05/03/22</h5>
            <p class="text-white">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Blanditiis eum excepturi
                illo ipsam itaque neque odio soluta. Architecto atque, consectetur dolor doloremque ea ex laudantium
                nemo neque nesciunt nulla odio provident quo similique, sint sunt ullam vero voluptatibus. Odio,
                praesentium!</p>

            <h5 class="text-white font-weight-bold">Joe 05/03/22</h5>
            <p class="text-white">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Blanditiis eum excepturi
                illo ipsam itaque nequ ipsum dolor sit amet, consectetur adipisicing elit. Molestiae, sint!
                Lorem ipsum dolor sit amet, consectetur adipisicing elit. Expedita illo libero placeat quas recusandae
                sequi. Accusantium dolore doloremque expedita explicabo inventore labore numquam rem repellat velit,
                voluptates! Ad, consectetur culpa cum ipsum iure molestiae molestias officia omnis pariatur quas
                voluptate.
            </p>
        </div>
        <div class="line" id="line"></div>
        <footer class="footer my-3" id="box">
            <div class="input-group my-3">
                <textarea class="form-control text-white border-dark" id="messagebox"
                          rows="2" maxlength="250"
                          style="resize: none; background-color: #444; overflow:hidden;"></textarea>
                <div class="input-group-append">
                    <button class="btn btn-dark btn-outline-info" onclick="appendMessages()"> Send</button>
                </div>
            </div>
        </footer>
    </div>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
        integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
        crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js"></script>

<script type="text/javascript">
    $(document).ready(function () {
        $("#sidebar").mCustomScrollbar({
            theme: "minimal"
        });

        $('#sidebarCollapse').on('click', function () {
            $('#sidebar, #content').toggleClass('active');
            $('.collapse.in').toggleClass('in');
            $('a[aria-expanded=true]').attr('aria-expanded', 'false');
        });
    });
</script>
<script>
    function appendMessages() {
        let message = document.getElementById("messagebox").value;
        if (message.length !== 0) {
            let returnData = [];
            $.ajax({
                type: "POST",
                url: "php/message_handler.php",
                async: false,
                data: {
                    message: message
                },
                success: function (data) {
                    returnData = data;
                }
            });
            document.getElementById("messages").innerHTML += "<p class='text-white wrap' id='tmp'><\p>";
            document.getElementById("tmp").innerText = returnData;
            document.getElementById("tmp").removeAttribute("id");
            document.getElementById("messagebox").value = "";
            $(document).scrollTop($(document).height());
        }
    }
</script>
<script>
    function getMessages(id) {
        let returnData = [];
        $.ajax({
            type: "POST",
            url: "php/message_handler.php",
            async: false,
            data: {
                id: id,
                get_message: 1
            },
            success: function (data) {
                if (data !== "0") {
                    returnData = JSON.parse(data);
                    console.log(data)
                    document.getElementById("line").style = "";
                    document.getElementById("box").style = "";
                    document.getElementById("messages").innerHTML = "<br><br>"
                    document.getElementById("messagebox").placeholder = "Message " + Object.values(returnData[id]);
                    for (let date in returnData) {
                        if (date !== id.toString()) {
                            let previous = "";
                            document.getElementById("messages").innerHTML += "<h3 style='text-align: center'><span class='text-white mx-3'>" + date + "</span></h3>";
                            for (let value = returnData[date][0].length - 1; value >= 0; value--) {
                                let user = returnData[date][0][value];
                                let message = returnData[date][1][value];
                                let time = returnData[date][2][value];

                                if (user !== previous) {
                                    document.getElementById("messages").innerHTML += "<span class='text-white font-weight-bold' style='font-size: 125%'>" + user + " " + time + "</span>";
                                    previous = user;
                                }
                                document.getElementById("messages").innerHTML += "<p class='text-white wrap' id='tmp'><\p>";
                                document.getElementById("tmp").innerText = message;
                                document.getElementById("tmp").removeAttribute("id");
                            }

                        }
                        $(document).scrollTop($(document).height());
                    }
                } else {
                    document.getElementById("messages").innerHTML = "<br><br><h1 style='text-align: center'><span class='text-white mx-3' >Conversation Starts Here</span></h1>"
                }
            }
        });

    }
</script>
<script>
    function closeModal() {
        document.getElementById("alert").innerText = "";
        document.getElementById("addField").value = "";
    }

    function addConversation() {
        let friend = document.getElementById("addField").value;
        if (friend.length !== 0) {
            $('#searchModal').modal('hide');

            let returnData = [];
            $.ajax({
                type: "POST",
                url: "php/add_handler.php",
                datatype: 'json',
                async: false,
                data: {
                    username: friend
                },
                success: function (data) {
                    returnData = JSON.parse(data);
                }
            });

            document.getElementById("conversations").innerHTML += "<li><a href='#' className='list-group-item list-group-item-action py-2 secondary_c text-white bg-transparent'><button class='btn secondary_c text-white' id='tmp'></button></a></li>";
            document.getElementById("tmp").innerText = returnData[0];
            document.getElementById("tmp").removeAttribute("id");
            closeModal()
        } else {
            document.getElementById("alert").innerText = "Invalid input!";
        }
    }
</script>
<script>
    window.onload = function () {
        let returnData = [];
        $.ajax({
            type: "POST",
            url: "php/message_handler.php",
            async: false,
            data: {
                load: 1
            },
            success: function (data) {
                returnData = JSON.parse(data);
            }
        });
        for (let i in returnData) {
            if (i === "0") {
                document.getElementById("user").innerText = returnData[i];
            } else {
                document.getElementById("conversations").innerHTML += "<li class='conversation_btn' onclick='getMessages(" + i + ")'><a class='list-group-item list-group-item-action py-2 secondary_c text-white bg-transparent'><div class='secondary_c text-white'>" + returnData[i] + "</div></a>";
            }
        }
        $(document).scrollTop($(document).height());
    }
</script>
</body>
</html>